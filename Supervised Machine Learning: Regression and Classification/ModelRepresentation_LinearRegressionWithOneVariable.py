# ==============================================
# 单变量线性回归模型实现 - 房价预测实验
# 核心目标：拟合线性模型 f_wb = w*x + b，并用其预测房价
# ==============================================

# 1. 导入必要的库
# numpy：用于数值计算（数组操作、数学运算）
# matplotlib.pyplot：用于数据可视化（绘制散点图、直线）
# matplotlib：用于全局配置（如中文字体、负号显示）
import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

# 设置绘图样式（适配课程统一风格，可注释掉不影响核心功能）
# plt.style.use('./deeplearning.mplstyle')

# ========== 核心修复：配置Matplotlib支持中文 ==========
# 设置全局字体为微软雅黑（Windows系统），其他系统可换对应中文字体
# Windows：'Microsoft YaHei' / 'SimHei'（黑体）
# Mac：'PingFang SC'
# Linux：'WenQuanYi Micro Hei'
mpl.rcParams['font.sans-serif'] = ['Microsoft YaHei']  # 设置中文主字体
mpl.rcParams['axes.unicode_minus'] = False  # 解决负号显示为方块的问题
# ====================================================

# ==============================================
# 2. 数据准备：定义训练数据集
# ==============================================
# x_train：输入特征（房屋面积，单位：千平方英尺）
# y_train：目标值（房屋价格，单位：千美元）
x_train = np.array([1.0, 2.0])  # 1.0=1000平方英尺，2.0=2000平方英尺
y_train = np.array([300.0, 500.0])  # 300=30万美元，500=50万美元

# 打印数据集，验证数据是否正确加载
print("="*50)
print("训练数据集信息：")
print(f"面积特征 x_train = {x_train} (千平方英尺)")
print(f"房价目标 y_train = {y_train} (千美元)")
print("="*50)

# ==============================================
# 3. 统计训练样本数量 m
# ==============================================
# 方法1：使用numpy数组的shape属性（shape[0]表示数组第一维度长度）
m_shape = x_train.shape[0]
# 方法2：使用Python内置len()函数（更直观）
m_len = len(x_train)

# 打印样本数量，两种方法结果一致
print(f"\n训练样本数量（shape方法）：m = {m_shape}")
print(f"训练样本数量（len方法）：m = {m_len}")

# ==============================================
# 4. 访问单个训练样本 (x^(i), y^(i))
# ==============================================
# Python索引从0开始，i=0对应第一个样本，i=1对应第二个样本
i = 0  # 可修改为1查看第二个样本
x_i = x_train[i]  # 第i个样本的面积
y_i = y_train[i]  # 第i个样本的房价

print(f"\n第 {i} 个训练样本：")
print(f"(x^({i}), y^({i})) = ({x_i} 千平方英尺, {y_i} 千美元)")

# ==============================================
# 5. 可视化训练数据（散点图）
# ==============================================
print("\n正在绘制训练数据散点图...")
# 绘制散点图：x轴=面积，y轴=房价，marker='x'表示叉形标记，c='r'表示红色
plt.scatter(x_train, y_train, marker='x', c='r')
# 设置图表标题
plt.title("房屋价格数据集")
# 设置y轴标签（含单位）
plt.ylabel('房价（千美元）')
# 设置x轴标签（含单位）
plt.xlabel('面积（千平方英尺）')
# 显示图表（阻塞式，关闭图表后继续执行后续代码）
plt.show()

# ==============================================
# 6. 定义线性回归模型预测函数
# 函数功能：根据输入x、参数w和b，计算模型预测值 f_wb = w*x + b
# ==============================================
def compute_model_output(x, w, b):
    """
    计算线性回归模型的预测值
    参数说明：
        x (ndarray (m,)): 输入特征数组，m个训练样本的面积
        w (scalar)      : 模型权重（直线斜率）
        b (scalar)      : 模型偏置（直线截距）
    返回值：
        f_wb (ndarray (m,)): 模型对每个样本的预测房价
    """
    # 获取样本数量
    m = x.shape[0]
    # 初始化预测值数组，长度m，所有元素初始为0
    f_wb = np.zeros(m)
    # 遍历每个样本，计算预测值
    for i in range(m):
        f_wb[i] = w * x[i] + b  # 线性模型核心公式
    
    return f_wb

# ==============================================
# 7. 测试模型参数，可视化预测结果
# ==============================================
# 第一步：初始化模型参数（可修改参数观察效果）
# 初始参数w=100, b=100（拟合效果差）
w = 100
b = 100
print(f"\n当前模型参数：w = {w}, b = {b}")

# 第二步：调用预测函数，计算模型对训练数据的预测值
tmp_f_wb = compute_model_output(x_train, w, b)

# 第三步：可视化模型预测结果（直线）+ 真实数据（散点）
print("正在绘制模型预测结果与真实数据对比图...")
# 绘制模型预测直线：蓝色，标签为“模型预测”
plt.plot(x_train, tmp_f_wb, c='b', label='模型预测')
# 绘制真实样本点：红色叉形，标签为“真实值”
plt.scatter(x_train, y_train, marker='x', c='r', label='真实值')
# 设置图表标题
plt.title("房屋价格预测")
# 设置坐标轴标签
plt.ylabel('房价（千美元）')
plt.xlabel('面积（千平方英尺）')
# 显示图例（区分预测线和真实值）
plt.legend()
# 显示图表
plt.show()

# ==============================================
# 8. 调整参数并进行实际预测
# 最优参数（拟合数据）：w=200, b=100
# ==============================================
# 调整为最优参数
w_opt = 200
b_opt = 100
print(f"\n调整后最优模型参数：w = {w_opt}, b = {b_opt}")

# 预测1200平方英尺房屋的价格（转换为1.2千平方英尺）
x_predict = 1.2  # 待预测的房屋面积（千平方英尺）
y_predict = w_opt * x_predict + b_opt  # 模型预测公式

# 打印预测结果（.0f表示保留0位小数）
print(f"\n预测结果：")
print(f"1200平方英尺的房屋价格 = ${y_predict:.0f} 千美元（即 ${y_predict*1000:.0f} 美元）")

# 可视化最优模型拟合效果
print("\n正在绘制最优模型拟合效果...")
# 计算最优模型对训练数据的预测值
f_wb_opt = compute_model_output(x_train, w_opt, b_opt)
# 绘制最优模型直线
plt.plot(x_train, f_wb_opt, c='g', label='最优模型预测')
# 绘制真实样本点
plt.scatter(x_train, y_train, marker='x', c='r', label='真实值')
# 标记预测点（1200平方英尺）
plt.scatter(x_predict, y_predict, marker='o', c='orange', label='1200sqft预测值')
# 设置标题和标签
plt.title("最优模型拟合效果与预测结果")
plt.ylabel('房价（千美元）')
plt.xlabel('面积（千平方英尺）')
plt.legend()
plt.show()

# ==============================================
# 9. 实验总结输出
# ==============================================
print("\n" + "="*60)
print("实验总结：")
print("1. 线性回归模型核心公式：f_wb = w*x + b")
print(f"2. 拟合本数据集的最优参数：w={w_opt}, b={b_opt}")
print(f"3. 1200平方英尺房屋预测价格：{y_predict:.0f} 千美元")
print("="*60)
